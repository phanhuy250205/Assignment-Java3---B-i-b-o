<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Management</title>
    <link rel="stylesheet" href="./assets/css/crud.css">
    <style>
        /* Simple styles for better visibility */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1, h2 {
            color: #333;
        }
        input, textarea {
            margin: 10px 0;
            padding: 10px;
            width: calc(100% - 22px);
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        .tabcontent {
            display: none;
        }
        .active {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quản lý hệ thống</h1>

        <!-- Login Form -->
        <div id="loginSection">
            <h2>Đăng nhập</h2>
            <form id="loginForm">
                <input type="text" id="username" placeholder="Tên người dùng" required>
                <input type="password" id="password" placeholder="Mật khẩu" required>
                <button type="submit">Đăng nhập</button>
            </form>
        </div>

        <!-- Reader Section -->
        <div id="readerSection">
            <h2>Tìm kiếm và đọc tin</h2>
            <input type="text" id="searchNews" placeholder="Tìm theo loại tin" oninput="searchNews()">
            <div id="readerNewsList"></div>
        </div>

        <!-- Tabs for CRUD Management -->
        <div class="tab" id="crudTabs" style="display: none;">
            <button class="tablinks" onclick="openCRUD(event, 'News')">Quản lý tin tức</button>
            <button class="tablinks" onclick="openCRUD(event, 'Categories')">Quản lý loại tin</button>
            <button class="tablinks" onclick="openCRUD(event, 'Users')">Quản lý người dùng</button>
            <button class="tablinks" onclick="openCRUD(event, 'Newsletter')">Quản lý Newsletter</button>
        </div>

        <!-- News Section -->
        <div id="News" class="tabcontent">
            <h2>Quản lý tin tức</h2>
            <form id="newsForm" style="display: none;">
                <input type="text" id="newsTitle" placeholder="Tiêu đề tin tức" required>
                <textarea id="newsContent" placeholder="Nội dung tin tức" required></textarea>
                <input type="file" id="newsFile" accept="image/*"> <!-- File upload input -->
                <button type="submit">Thêm mới</button>
                <button type="button" onclick="resetForm('newsForm')">Làm mới</button>
            </form>
            <table id="newsTable">
                <thead>
                    <tr>
                        <th>Tiêu đề</th>
                        <th>Nội dung</th>
                        <th>File</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="newsList"></tbody>
            </table>
        </div>

        <!-- Categories Section -->
        <div id="Categories" class="tabcontent">
            <h2>Quản lý loại tin</h2>
            <form id="categoryForm" style="display: none;">
                <input type="text" id="categoryName" placeholder="Tên loại tin" required>
                <button type="submit">Thêm mới</button>
                <button type="button" onclick="resetForm('categoryForm')">Làm mới</button>
            </form>
            <table id="categoryTable">
                <thead>
                    <tr>
                        <th>Tên loại tin</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="categoryList"></tbody>
            </table>
        </div>

        <!-- Users Section -->
        <div id="Users" class="tabcontent">
            <h2>Quản lý người dùng</h2>
            <form id="userForm" style="display: none;">
                <input type="text" id="userName" placeholder="Tên người dùng" required>
                <input type="email" id="userEmail" placeholder="Email" required>
                <button type="submit">Thêm mới</button>
                <button type="button" onclick="resetForm('userForm')">Làm mới</button>
            </form>
            <table id="userTable">
                <thead>
                    <tr>
                        <th>Tên người dùng</th>
                        <th>Email</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="userList"></tbody>
            </table>
        </div>

        <!-- Newsletter Section -->
        <div id="Newsletter" class="tabcontent">
            <h2>Quản lý Newsletter</h2>
            <form id="newsletterForm" style="display: none;">
                <input type="email" id="newsletterEmail" placeholder="Email nhận tin" required>
                <button type="submit">Thêm mới</button>
                <button type="button" onclick="resetForm('newsletterForm')">Làm mới</button>
            </form>
            <table id="newsletterTable">
                <thead>
                    <tr>
                        <th>Email nhận tin</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="newsletterList"></tbody>
            </table>
        </div>
    </div>

    <script>
        // User roles (for demo purposes)
        const users = {
            admin: { password: 'admin123', role: 'admin' },
            reporter: { password: 'reporter123', role: 'reporter' },
            reader: { password: 'reader123', role: 'reader' }
        };
        let currentUser = null;

        // Login
        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (users[username] && users[username].password === password) {
                currentUser = users[username];
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('crudTabs').style.display = 'block';
                openCRUD(event, 'News');
                setupUserRole();
            } else {
                alert('Tên người dùng hoặc mật khẩu không đúng!');
            }
        });

        // Set up user role
        function setupUserRole() {
            const isAdminOrReporter = currentUser.role === 'admin' || currentUser.role === 'reporter';
            document.getElementById('newsForm').style.display = isAdminOrReporter ? 'block' : 'none';
            document.getElementById('categoryForm').style.display = currentUser.role === 'admin' ? 'block' : 'none';
            document.getElementById('userForm').style.display = currentUser.role === 'admin' ? 'block' : 'none';
            document.getElementById('newsletterForm').style.display = 'block'; // All users manage newsletters

            // Show delete buttons for admin and reporter
            toggleActionButtons(isAdminOrReporter);
        }

        // Toggle edit/delete buttons based on user role
        function toggleActionButtons(show) {
            toggleButtons('#newsList', show);
            toggleButtons('#categoryList', currentUser.role === 'admin');
            toggleButtons('#userList', currentUser.role === 'admin' || currentUser.role === 'reporter');
            toggleButtons('#newsletterList', show);
        }

        function toggleButtons(listId, show) {
            const rows = document.querySelectorAll(listId + ' tr');
            rows.forEach(row => {
                const actionCell = row.querySelector('td:last-child');
                if (actionCell) {
                    actionCell.innerHTML = show 
                        ? `<button onclick="editRow(this)">Sửa</button> <button onclick="deleteRow(this)">Xóa</button>` 
                        : '';
                }
            });
        }

        // Search news function for readers
        function searchNews() {
            const query = document.getElementById('searchNews').value.toLowerCase();
            const rows = document.querySelectorAll('#newsList tr');
            rows.forEach(row => {
                const title = row.cells[0].textContent.toLowerCase();
                row.style.display = title.includes(query) ? '' : 'none';
            });
        }

        // Open tab function
        function openCRUD(evt, tabName) {
            const tabcontent = document.getElementsByClassName('tabcontent');
            const tablinks = document.getElementsByClassName('tablinks');
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = 'none';
            }
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(' active', '');
            }
            document.getElementById(tabName).style.display = 'block';
            evt.currentTarget.className += ' active';
        }

        // Reset form
        function resetForm(formId) {
            document.getElementById(formId).reset();
        }

        // Add news
        document.getElementById('newsForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;
            const file = document.getElementById('newsFile').files[0] ? document.getElementById('newsFile').files[0].name : 'No file uploaded';

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${title}</td>
                <td>${content}</td>
                <td>${file}</td>
                <td></td>
            `;
            document.getElementById('newsList').appendChild(row);
            resetForm('newsForm');
            toggleActionButtons(currentUser.role === 'admin' || currentUser.role === 'reporter');
        });

        // Edit row
        function editRow(button) {
            const row = button.closest('tr');
            document.getElementById('newsTitle').value = row.cells[0].textContent;
            document.getElementById('newsContent').value = row.cells[1].textContent;
            // The file handling is not implemented for edit.
            document.getElementById('newsFile').value = ''; // Reset file input
            row.remove(); // Remove the old row after capturing data
        }

        // Delete row
        function deleteRow(button) {
            const row = button.closest('tr');
            row.remove();
        }

        // Add user function
        document.getElementById('userForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${name}</td>
                <td>${email}</td>
                <td></td>
            `;
            document.getElementById('userList').appendChild(row);
            resetForm('userForm');
            toggleActionButtons(currentUser.role === 'admin');
        });

        // Add newsletter function
        document.getElementById('newsletterForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const email = document.getElementById('newsletterEmail').value;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${email}</td>
                <td></td>
            `;
            document.getElementById('newsletterList').appendChild(row);
            resetForm('newsletterForm');
            toggleActionButtons(currentUser.role === 'admin' || currentUser.role === 'reporter');
        });
    </script>
</body>
</html>
